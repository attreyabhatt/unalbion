{% extends 'base.html' %}

{% block head_title %}
Unalbion - Animal Artifacts
{% endblock head_title %}

{% block content %}

{% load static %}
{% load get_item %}

<div class="container">
    <div class="row mb-3 mt-3">
        <div class="col-md-12">
            <h1>Animal Artifacts</h1>
            <p>Enter the currrent market price of each animal artifact, being sold at the market.</p>
        </div>
    </div>

    <form id="animal_artifacts_form" name="animal_artifacts_form" method="POST" action="{% url 'animal_artifacts' %}">
        {% csrf_token %}

        <div class="table-responsive">
            <table class="table table-hover table-bordered table-striped align-middle ">
                <caption class="text-muted">Enter the current market price of each animal artifact</caption>
                <thead class="table-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Animal Name</th>
                        <th scope="col">Rugged (T3)</th>
                        <th scope="col">Fine (T5)</th>
                        <th scope="col">Excellent (T7)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for name, items_by_tier in grouped_items.items %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><strong>{{ name }}</strong></td>
                        {% for tier in artifact_types %}
                        <td>
                            {% with item=items_by_tier|get_item:tier %}
                            {% if item %}
                            <input type="number" class="form-control form-control-sm" id="{{ item.code_name }}"
                                name="{{ item.code_name }}" placeholder="Enter Price"
                                value="{{ item.market_price|default:'' }}" data-name="{{ item.name }}"
                                data-tier="T{{ item.artifact.get_artifact_type_display|slice:':1' }} {{ item.artifact.get_artifact_type_display }}">
                            {% else %}
                            <span class="text-muted">–</span>
                            {% endif %}
                            {% endwith %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="row justify-content-center mt-3">
            <div class="col-sm-auto">
                <button type="submit" class="btn btn-primary px-4" id="calculate-profit-btn">Calculate Profit</button>
            </div>
        </div>
    </form>

    <style>
        .table-light {
            background-color: #f8f9fa !important;
            font-size: 1rem;
            letter-spacing: 0.5px;
        }

        #profit-table tbody tr td:first-child {
            font-weight: bold;
        }
    </style>

    <h4 class="mt-5">Profit Table</h4>
    <div class="form-check form-switch mb-3">
        <input class="form-check-input" type="checkbox" id="profitToggle" checked>
        <label class="form-check-label" for="profitToggle">Show Only Profitable Rows</label>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover align-middle shadow-sm table-sm" id="profit-table">
            <thead class="table-primary text-center">
                <tr>
                    <th style="width: 30%">Animal Name</th>
                    <th style="width: 35%">From → To</th>
                    <th style="width: 35%">Profit (Silver)</th>
                </tr>
            </thead>
            <tbody class="table-group-divider"></tbody>
        </table>
    </div>




</div>

<script src="{% static 'js/main.js' %}"></script>

{% endblock content %}